{% extends "base.html" %}
{% block style %}
#summary-bar {
  font-size: 1.1rem;
  background: #f0f0f0;
  padding: 10px 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.summary-section .card {
    height: 100%;
}
  
.summary-section .card-header {
font-size: 1.1rem;
font-weight: 600;
}

#summary-3dviewer {
    position: relative;   /* canvasê°€ íŠ€ì–´ë‚˜ì˜¤ì§€ ì•Šë„ë¡ */
    z-index: 0;           /* í—¤ë”ë³´ë‹¤ ì•„ë˜ë¡œ */
    height: 400px;
    width: 100%;
    overflow: hidden;     /* í˜¹ì‹œë¼ë„ canvasê°€ ë„˜ì¹˜ë©´ ìˆ¨ê¸°ê¸° */
}

.card-body {
    position: relative;   /* ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ ì•ˆì •í™” */
}
{% endblock %}
{% block content %}

<div class="container mt-5">
  <h2 class="text-primary mb-4">ğŸ§¬ Proteinmpnn 3D Virtual Results</h2>

  <!-- âœ… summary-section row: ê°€ë¡œë¡œ ë‚˜ë€íˆ -->
  <div class="summary-section row mb-5">
  
    <!-- ğŸ”¹ ì™¼ìª½: 3D ë·°ì–´ (8/12 ë„ˆë¹„) -->
    <div class="col-md-8">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
          <button class="btn btn-sm btn-outline-dark" onclick="showInputModel()">Input Model</button>
          <button class="btn btn-sm btn-outline-dark" onclick="showPredModel()">Predicted Model</button>
          <button class="btn btn-sm btn-outline-dark" onclick="setStyleCartoon()">White</button>
          <button class="btn btn-sm btn-outline-dark" onclick="setStyleStick()">Stick</button>
          <button class="btn btn-sm btn-outline-dark" onclick="resetStyleCartoon()">Cartoon</button>
          <button class="btn btn-sm btn-outline-dark" onclick="toggleSpin()">Spin</button>
          <button class="btn btn-sm btn-outline-dark" onclick="resetZoom()">Reset Zoom</button>
        </div>
        <div class="card-body p-0">
          <div id="viewer" style="width: 100%; height: 700px;"></div>
        </div>
      </div>
    </div>

    <!-- ğŸ”¹ ì˜¤ë¥¸ìª½: FASTA (4/12 ë„ˆë¹„) -->
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <strong>ğŸ“„ Predicted FASTA Sequence</strong>
        </div>
        <div class="card-body">
          <pre style="white-space: pre-wrap; font-family: monospace; max-height: 700px; overflow-y: auto;">{{ result_mfasta }}</pre>
        </div>
      </div>
    </div>

  </div>
</div>


<script>
  const viewer = $3Dmol.createViewer("viewer", { backgroundColor: "white" });

  // ğŸ”¥ Django í…œí”Œë¦¿ì—ì„œ input_pdbì™€ pred_pdbë¥¼ ê°ê° ë°›ê¸°
  const inputPdbData = `{{ input_pdb|safe }}`;
  const predPdbData = `{{ pred_pdb|safe }}`;

  let currentModel = "input";  // ê¸°ë³¸ê°’: input

  function loadModel(modelType) {
    viewer.removeAllModels();
    if (modelType === "input") {
      viewer.addModel(inputPdbData, "pdb");
    } else if (modelType === "pred") {
      viewer.addModel(predPdbData, "pdb");
    }
    viewer.setStyle({}, { cartoon: { color: "spectrum" } });
    viewer.zoomTo();
    viewer.render();
  }

  // âœ… ì´ˆê¸°ì—ëŠ” input_pdb ë³´ì—¬ì£¼ê¸°
  loadModel("input");

  function setStyleCartoon() {
    viewer.setStyle({}, { cartoon: { color: "white" } });
    viewer.render();
  }

  function resetStyleCartoon() {
    viewer.setStyle({}, { cartoon: { color: "spectrum" } });
    viewer.render();
  }

  function setStyleStick() {
    viewer.setStyle({}, { stick: { radius: 0.3 } });
    viewer.render();
  }

  let isSpinning = false;
  function toggleSpin() {
    isSpinning = !isSpinning;
    viewer.spin(isSpinning);  // â† ì´ê²ƒë§Œ ì‚¬ìš©!
  }

  function resetZoom() {
    viewer.zoomTo();
    viewer.render();
  }

  // ğŸ”¥ ë²„íŠ¼ ì¶”ê°€í•´ì„œ input <-> pred ì „í™˜í•˜ê¸°
  function showInputModel() {
    loadModel("input");
  }

  function showPredModel() {
    loadModel("pred");
  }
</script>

{% endblock %}
